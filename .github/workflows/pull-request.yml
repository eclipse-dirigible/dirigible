name: Pull Request

on:
  pull_request:
    branches: 
      - main
      - master
jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0
    - name: Set up JDK 13
      uses: actions/setup-java@v1
      with:
        java-version: 13
    - name: Cache Maven Packages
      uses: actions/cache@v1
      with:
        path: ~/.m2
        key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
        restore-keys: ${{ runner.os }}-m2
    - name: Maven Build
      run: mvn clean install
    - name: Get PR Number
      run: echo ${{ github.event.number }} > dirigible-pr.txt
    - name: Upload Dirigible PR Number
      uses: actions/upload-artifact@v3.1.0
      with:
        name: dirigible-pr
        path: ${{ github.workspace }}/dirigible-pr.txt
    - name: Upload Dirigible Compiled Sources
      uses: actions/upload-artifact@v3.1.0
      with:
        name: dirigible-sources
        path: |
          ${{ github.workspace }}/target/classes
          ${{ github.workspace }}/target/test-classes
          ${{ github.workspace }}/**/target/classes
          ${{ github.workspace }}/**/target/test-classes
          ${{ github.workspace }}/**/**/target/classes
          ${{ github.workspace }}/**/**/target/test-classes
          ${{ github.workspace }}/**/**/**/target/classes
          ${{ github.workspace }}/**/**/**/target/test-classes
          ${{ github.workspace }}/coverage
